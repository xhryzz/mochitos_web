<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Medallas & Puntos</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
      <link rel="icon" href="{{ url_for('static', filename='favicon.ico') }}">

  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;800&family=Playfair+Display:wght@700;900&display=swap" rel="stylesheet">
  <style>
    body{font-family:Montserrat,system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,sans-serif;background:linear-gradient(135deg,#ffe8f3 0%,#dfe6e9 100%);margin:0;color:#222;}
    .wrap{max-width:1100px;margin:30px auto;padding:0 16px;}
    h1{font-family:'Playfair Display',serif;font-weight:900;margin:0 0 8px 0}
    .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:16px;}
    .card{background:white;border-radius:16px;box-shadow:0 10px 25px rgba(0,0,0,.08);padding:18px;}
    .btn{display:inline-block;padding:10px 14px;border-radius:12px;background:#e84393;color:white;text-decoration:none}
    .ach{display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:14px;}
  </style>
</head>
<body>
  <div class="wrap">
    <div style="display:flex;justify-content:space-between;align-items:center;">
      <div>
        <h1>üèÖ Medallas & Puntos</h1>
        <div style="color:#666">Tus logros, rachas y el ranking entre nosotros.</div>
      </div>
      <div><a class="btn" href="/tienda">Ir a la tienda</a></div>
    </div>

    <div class="grid" style="margin-top:14px">
      <div class="card">
        <div style="font-size:14px;color:#888;">Puntos</div>
        <div id="pts" style="font-size:38px;font-weight:800;line-height:1.1;">‚Äî</div>
      </div>
      <div class="card">
        <div style="font-size:14px;color:#888;">Racha actual</div>
        <div id="streak" style="font-size:38px;font-weight:800;">‚Äî</div>
        <div style="color:#888;">d√≠as seguidos</div>
      </div>
      <div class="card">
        <div style="font-size:14px;color:#888;">Primeras respuestas</div>
        <div id="firsts" style="font-size:38px;font-weight:800;">‚Äî</div>
      </div>
      <div class="card">
        <div style="font-size:14px;color:#888;">D√≠as totales</div>
        <div id="days" style="font-size:38px;font-weight:800;">‚Äî</div>
      </div>
    </div>

    <h2 style="margin:24px 0 8px;">Tus medallas</h2>
    <div id="medallas-list" class="ach"></div>

    <h2 style="margin:28px 0 8px;">Ranking</h2>
    <div id="ranking" class="grid"></div>
  </div>

<script>
fetch('/api/medallas/summary').then(r=>r.json()).then(d=>{
  document.getElementById('pts').textContent = d.points;
  document.getElementById('streak').textContent = d.streak;
  document.getElementById('firsts').textContent = d.first_count;
  document.getElementById('days').textContent = d.total_days;

  const wrap = document.getElementById('medallas-list');
  wrap.innerHTML = '';
  d.achievements.forEach(a => {
    const card = document.createElement('div');
    card.className = 'card';
    card.style.display = 'flex';
    card.style.gap = '12px';
    card.style.alignItems = 'center';
    const icon = document.createElement('div');
    icon.style.fontSize = '28px';
    icon.textContent = a.icon || 'üèÖ';
    const info = document.createElement('div');
    const title = document.createElement('div');
    title.style.fontWeight = '700';
    title.textContent = a.title;
    const desc = document.createElement('div');
    desc.style.color = '#666';
    desc.style.fontSize = '0.95rem';
    desc.textContent = a.description || '';
    const chip = document.createElement('div');
    chip.textContent = a.earned ? 'Conseguida' : 'Pendiente';
    chip.style.cssText = 'margin-top:6px;display:inline-block;padding:4px 10px;border-radius:999px;font-size:12px;' + (a.earned ? 'background:#e8fff1;color:#0a8f3f;' : 'background:#fff4f4;color:#cc1e3f;');
    info.appendChild(title); info.appendChild(desc); info.appendChild(chip);
    card.appendChild(icon); card.appendChild(info);
    wrap.appendChild(card);
  });

  const rk = document.getElementById('ranking');
  rk.innerHTML = '';
  d.ranking.forEach((r,i)=>{
    const li = document.createElement('div');
    li.className = 'card';
    li.style.display = 'flex';
    li.style.justifyContent = 'space-between';
    li.style.alignItems = 'center';
    li.innerHTML = `<div><strong>#${i+1}</strong> ${r.username}</div><div style="font-weight:800">${r.points} pts</div>`;
    rk.appendChild(li);
  });
});
</script>
</body>
</html>
