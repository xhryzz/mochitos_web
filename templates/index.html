<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Christian y Clara 💖</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700;900&family=Montserrat:wght@300;400;500;600;700&family=Dancing+Script:wght@600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>

      /*************************************************
  THEME V2 — Glow & Glass ✨
  Hoja COMPLETA para reemplazar la actual
  (No cambia tu HTML; solo estilos)
**************************************************/

/* ===== Variables ===== */
:root{
  --primary-color: #ff5ca8;
  --secondary-color: #ffa3c7;
  --accent-color:   #9aa7ff;

  --visited-color:  #10b981;   /* verde bonito */
  --wishlist-color: #ff6aa2;   /* rosa intenso */
  --purchased-color:#bfc6d1;   /* gris premium */

  --bg-soft:  #fff7fb;
  --ink:      #1f2441;
  --ink-soft: #606580;

  --card-bg:  rgba(255,255,255,.92);
  --glass:    rgba(255,255,255,.18);
  --stroke:   rgba(154,167,255,.35);

  --shadow-xl: 0 30px 60px rgba(31,36,65,.16);
  --shadow-lg: 0 24px 48px rgba(31,36,65,.14);
  --shadow-md: 0 16px 32px rgba(31,36,65,.10);
  --shadow-sm: 0 8px 18px  rgba(31,36,65,.08);

  --gradient:   linear-gradient(135deg,#ff6aa2 0%, #ffa3c7 38%, #9aa7ff 100%);
  --gradient-2: linear-gradient(135deg,#8aa9ff 0%, #c8b6ff 50%, #ff9ec7 100%);
}

/* ===== Reset básico ===== */
*{ box-sizing:border-box; margin:0; padding:0; }
img{ display:block; max-width:100%; }
button{ cursor:pointer; }

/* ===== Fondo / tipografía ===== */
body{
  font-family: 'Montserrat', sans-serif;
  color: var(--ink);
  line-height: 1.6;
  min-height: 100vh;
  overflow-x: hidden;
  background:
    radial-gradient(1200px 800px at 100% -20%, #fff0f7 0%, transparent 60%),
    radial-gradient(1000px 700px at -10% 110%, #eef2ff 0%, transparent 60%),
    linear-gradient(180deg,#fff,#fbfcff);
}
body, input, button, textarea, select { font-feature-settings: "ss01","cv02"; }

.container{
  max-width: 1240px;
  margin: 0 auto;
  padding: clamp(16px,3vw,28px);
  padding-bottom: 44px; /* espacio footer */
}

/* ===== Banner ===== */
.section.banner{
  position: relative;
  margin-bottom: 40px;
  border-radius: 26px;
  overflow: clip;
  border: 1px solid var(--stroke);
  box-shadow: 0 36px 70px rgba(31,36,65,.18);
  height: clamp(320px, 42vw, 480px);
}
.section.banner img{
  width:100%; height:100%; object-fit:cover;
  transform: scale(1.02);
  transition: transform .8s ease, filter .8s ease;
  filter: saturate(1.05) contrast(1.03);
}
.section.banner:hover img{
  transform: scale(1.06);
  filter: saturate(1.08) contrast(1.05);
}
.banner::after{
  content:"";
  position:absolute; inset:0;
  background: radial-gradient(120% 80% at 80% 10%, rgba(255,106,162,.35), transparent 60%),
              linear-gradient(to top, rgba(0,0,0,.45), transparent 38%);
  pointer-events:none;
}
.banner-overlay{
  position:absolute; inset:auto 0 0 0;
  padding: clamp(18px,3vw,34px) clamp(16px,3vw,28px) clamp(16px,2vw,24px);
  color:#fff; text-align:center;
}
.banner-overlay h1{
  font-family: 'Dancing Script', cursive;
  font-size: clamp(2.2rem, 6vw, 4.6rem);
  letter-spacing: 1.5px;
  text-shadow: 0 2px 14px rgba(0,0,0,.32), 0 10px 32px rgba(255,106,162,.30);
  position: relative;
  display: inline-block;
}
.banner-overlay h1::after{
  content:"";
  display:block;
  height:6px; width: clamp(120px,18vw,200px);
  margin: 8px auto 0;
  border-radius:999px;
  background: var(--gradient);
  box-shadow: 0 10px 28px rgba(255,106,162,.35);
}
.banner-form{
  margin-top: 16px;
  display:flex; justify-content:center; gap:12px; flex-wrap:wrap;
  background: rgba(255,255,255,.15);
  border: 1px solid rgba(255,255,255,.55);
  border-radius: 999px;
  padding: 8px;
  backdrop-filter: blur(6px);
}
.custom-file-upload{
  background:#fff; color:var(--primary-color);
  border: 1px solid var(--stroke);
  padding: 10px 16px;
  border-radius: 12px;
  display:flex; align-items:center; gap:10px;
  transition: transform .12s ease, box-shadow .18s ease;
  box-shadow: var(--shadow-sm);
}
.custom-file-upload:hover{ transform: translateY(-2px); box-shadow: var(--shadow-md); }

/* ===== Secciones (cards) ===== */
.section{
  background: var(--card-bg);
  border-radius: 22px;
  padding: 26px;
  margin-bottom: 28px;
  border: 1px solid var(--stroke);
  box-shadow: var(--shadow-md);
  backdrop-filter: blur(6px);
  transition: transform .18s ease, box-shadow .18s ease, border-color .18s ease;
}
.section:hover{
  transform: translateY(-6px);
  box-shadow: var(--shadow-xl);
  border-color: rgba(154,167,255,.5);
}
.section h3{
  color: var(--primary-color);
  font-family: 'Playfair Display', serif;
  font-size: clamp(1.5rem, 2.6vw, 2.2rem);
  margin-bottom: 16px;
  letter-spacing:.2px;
  display:inline-block;
  position: relative;
}
.section h3::after{
  content:"";
  position:absolute; left:0; bottom:-6px;
  height:5px; width: 140px; border-radius:999px;
  background: var(--gradient);
  box-shadow: 0 8px 22px rgba(255,106,162,.35);
}

/* ===== Formularios / Inputs ===== */
form{ margin-top: 16px; }

input, button, textarea, select{
  font-family: inherit;
  font-size: 1rem;
}
input[type="text"], input[type="password"], input[type="date"],
input[type="url"], input[type="file"], textarea, select{
  width:100%;
  margin-bottom: 14px;
  padding: 14px 16px;
  background: rgba(255,255,255,.8);
  border: 1px solid var(--stroke);
  border-radius: 14px;
  box-shadow: inset 0 1px 0 rgba(255,255,255,.35);
  transition: box-shadow .15s ease, border-color .15s ease, background .15s ease;
}
input:focus, textarea:focus, select:focus{
  border-color: var(--accent-color);
  box-shadow: 0 0 0 4px rgba(154,167,255,.18);
  background: #fff;
}
select{
  appearance:none; -webkit-appearance:none; -moz-appearance:none;
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' fill='%23ff5ca8' viewBox='0 0 16 16'%3E%3Cpath d='M7.247 11.14 2.451 5.658C1.885 5.013 2.345 4 3.204 4h9.592a1 1 0 0 1 .753 1.659l-4.796 5.48a1 1 0 0 1-1.506 0z'/%3E%3C/svg%3E");
  background-repeat:no-repeat; background-position: right 14px center; background-size: 16px;
}

/* Select de prioridad (colores del panel de opciones) */
select[name="priority"] option[value="alta"]{  color:#ff6b6b; font-weight:600; }
select[name="priority"] option[value="media"]{ color:#f4a100; font-weight:600; }
select[name="priority"] option[value="baja"]{  color:#10b981; font-weight:600; }

/* ===== Botones ===== */
button{
  display:inline-block;
  border-radius: 14px;
  padding: 12px 18px;
  font-weight: 800; letter-spacing:.25px;
  color:#fff;
  background: var(--gradient);
  border: 1px solid var(--stroke);
  box-shadow: 0 12px 28px rgba(255,106,162,.28), inset 0 1px 0 rgba(255,255,255,.4);
  transition: transform .12s ease, box-shadow .18s ease, filter .12s ease;
}
button:hover{
  transform: translateY(-2px);
  box-shadow: 0 18px 36px rgba(255,106,162,.36);
}
button:active{ transform: translateY(0); filter: saturate(.95); }

/* Icon buttons */
.icon-btn{
  width: 38px; height: 38px; border-radius: 12px;
  background: #fff;
  border: 1px solid var(--stroke);
  box-shadow: var(--shadow-sm);
  color: var(--primary-color);
  display:flex; align-items:center; justify-content:center;
  transition: transform .12s ease, box-shadow .18s ease, background .15s ease, color .15s ease;
}
.icon-btn:hover{ background: var(--primary-color); color:#fff; transform: translateY(-2px); }
.icon-btn.plus{
  background: var(--gradient); color:#fff; border:0;
  box-shadow: 0 10px 26px rgba(154,167,255,.35);
}

/* Enlaces bonitos */
a, .wishlist-link{
  color: var(--ink);
  text-decoration: none;
  border-bottom: 2px solid var(--stroke);
  padding-bottom: 2px;
  transition: color .15s ease, border-color .15s ease;
}
a:hover, .wishlist-link:hover{
  color: var(--primary-color);
  border-color: var(--primary-color);
}

/* ===== Logout ===== */
.logout{
  position: fixed; top: 24px; right: 24px;
  background:#fff; color: var(--primary-color);
  padding: 10px 16px;
  border-radius: 14px;
  font-weight: 700;
  text-decoration:none;
  border: 1px solid var(--stroke);
  box-shadow: var(--shadow-sm);
  display:flex; align-items:center; gap:8px;
  z-index: 1000;
  transition: transform .12s ease, background .15s ease, color .15s ease;
}
.logout:hover{ background: var(--primary-color); color:#fff; transform: translateY(-2px); }

/* ===== Contadores ===== */
.counters{ display:flex; flex-wrap:wrap; gap: 22px; margin-bottom: 14px; }
.counter-item{
  flex:1; min-width: 220px; text-align:center;
  padding: 22px;
  background: var(--gradient-2);
  border: 1px solid rgba(255,255,255,.45);
  border-radius: 18px;
  color:#fff;
  box-shadow: var(--shadow-md);
}
.counter-item h4{ font-size:1.05rem; font-weight:600; opacity:.94; margin-bottom: 10px; }
.counter-item p{
  font-size: clamp(2rem, 5vw, 2.6rem);
  font-weight: 800;
  text-shadow: 0 8px 30px rgba(31,36,65,.25);
}

/* ===== Login ===== */
.login-container{
  display:flex; justify-content:center; align-items:center;
  min-height: calc(100vh - 48px);
  padding: 20px; background: var(--gradient);
}
.login-box{
  background: var(--card-bg);
  padding: clamp(28px, 4vw, 40px);
  border-radius: 24px;
  width: 100%; max-width: 460px;
  text-align:center;
  border: 1px solid var(--stroke);
  box-shadow: var(--shadow-lg);
}
.login-box h3{
  color: var(--primary-color);
  font-family: 'Playfair Display', serif;
  font-size: clamp(1.6rem, 4vw, 2.4rem);
  margin-bottom: 18px;
}
.error-message{
  color: #e74c3c; background:#ffeded;
  border-left:5px solid #e74c3c;
  border-radius: 12px;
  padding: 12px; margin-bottom: 14px;
}

/* ===== Hearts fondo ===== */
.floating-hearts{ position: fixed; inset:0; pointer-events:none; z-index:-1; }
.heart{
  position:absolute; color: rgba(232, 67, 147, 0.28);
  font-size: 20px; animation: float 8s ease-in-out infinite;
}
@keyframes float{
  0%{ transform: translateY(100vh) rotate(0deg); opacity:0; }
  10%{ opacity:1; } 90%{ opacity:1; }
  100%{ transform: translateY(-100px) rotate(360deg); opacity:0; }
}

/* ===== Tabs (travel & wishlist) ===== */
.travel-tabs, .wishlist-tabs{
  display:flex; gap:6px;
  margin-bottom: 14px;
  border-bottom: 1px solid var(--stroke);
  flex-wrap: wrap;
}
.travel-tab, .wishlist-tab{
  padding: 10px 14px;
  cursor:pointer; font-weight:700;
  border-bottom: 3px solid transparent;
  border-radius: 10px 10px 0 0;
  color: var(--ink-soft);
  transition: background .15s ease, color .15s ease, border-color .15s ease;
}
.travel-tab:hover, .wishlist-tab:hover{
  background: rgba(154,167,255,.12); color: var(--ink);
}
.travel-tab.active, .wishlist-tab.active{
  color: var(--primary-color);
  border-bottom-color: var(--primary-color);
  background: rgba(255,106,162,.08);
}
.travel-content, .wishlist-content{ display:none; }
.travel-content.active, .wishlist-content.active{ display:block; }

/* ===== Grids y Cards (viajes & wishlist) ===== */
.travels-grid, .wishlist-grid{
  display:grid;
  grid-template-columns: repeat(auto-fill, minmax(300px,1fr));
  gap: 22px;
  margin-top: 10px;
}
.travel-card, .wishlist-card{
  background:#fff;
  border-radius: 18px;
  border: 1px solid var(--stroke);
  box-shadow: var(--shadow-sm);
  overflow: hidden;
  transition: transform .16s ease, box-shadow .18s ease, border-color .18s ease;
}
.travel-card:hover, .wishlist-card:hover{
  transform: translateY(-6px);
  box-shadow: var(--shadow-xl);
  border-color: rgba(154,167,255,.5);
}
.travel-card.visited{ border-left: 6px solid var(--visited-color); }
.travel-card.wishlist{ border-left: 6px solid var(--wishlist-color); }

.travel-cover{
  position:relative; height: 200px; overflow:hidden;
}
.travel-cover img{
  width:100%; height:100%; object-fit:cover;
  transition: transform .6s ease, filter .6s ease;
  filter: saturate(1.06) contrast(1.02);
}
.travel-card:hover .travel-cover img{ transform: scale(1.04); }

.travel-status, .wishlist-status{
  position:absolute; top: 14px; right: 14px;
  border-radius: 999px; padding: 6px 10px;
  font-size:.8rem; font-weight:800; color:#fff;
  box-shadow: 0 8px 20px rgba(0,0,0,.15);
}
.status-visited{ background: var(--visited-color); }
.status-wishlist{ background: var(--wishlist-color); }
.status-purchased{ background: var(--purchased-color); }

.travel-info{ padding: 18px; }
.travel-destination, .wishlist-product{
  font-family:'Playfair Display', serif;
  font-size: 1.25rem; color: var(--ink); font-weight: 800;
  margin-bottom: 6px;
}
.travel-date{
  color:#788; font-size:.92rem; margin-bottom: 10px;
}
.travel-description, .wishlist-notes{
  color:#566; line-height:1.55; margin-bottom: 12px;
}
.travel-meta, .wishlist-meta{
  display:flex; justify-content:space-between; align-items:center;
  margin-top: 8px; font-size: .95rem; color: var(--ink-soft);
}
.travel-actions, .wishlist-actions{
  display:flex; gap:10px; margin-top: 12px; align-items:center;
}

/* Avatar pequeño inline */
.user-avatar{
  width: 48px; height: 48px; border-radius:50%;
  background: var(--gradient); color:#fff; font-weight:800;
  display:flex; align-items:center; justify-content:center;
  overflow:hidden; flex-shrink:0;
  box-shadow: 0 6px 18px rgba(31,36,65,.15);
}
.user-avatar img{ width:100%; height:100%; object-fit:cover; }

/* ===== Chips ===== */
.priority-chip, .gift-chip{
  display:inline-flex; align-items:center; gap:8px;
  padding: 8px 12px; border-radius:999px; font-size:.82rem; font-weight:800;
  border: 1px solid var(--stroke);
  box-shadow: 0 6px 16px rgba(31,36,65,.06);
  margin: 4px 8px 8px 0;
}
.priority-high{ background:#ffe9ee; border-color:#ff7aa7; color:#bb205d; }
.priority-mid{  background:#fff6dc; border-color:#ffd166; color:#8a6b00; }
.priority-low{  background:#e9fff8; border-color:#6ddccf; color:#0f6b5c; }
.gift-chip{ background:#f1e8ff; border-color:#b197fc; color:#4b2dbf; }

/* Regalo oculto */
.gift-mask{
  display:flex; flex-direction:column; align-items:center; justify-content:center;
  min-height:120px; border:2px dashed #b197fc; border-radius:12px;
  padding:18px; background:#faf7ff; text-align:center; font-weight:700; color:#4b2dbf;
  margin:10px 0 12px 0;
}
.gift-mask small{ margin-top:6px; color:#6c5ce7; opacity:.85; }
.wishlist-card.locked .wishlist-actions{ display:none !important; }

/* ===== Modales ===== */
.modal{
  display:none; position:fixed; inset:0; z-index:1000;
  background: rgba(17,22,45,.55); backdrop-filter: blur(6px);
  animation: fadeIn .25s ease;
}
.modal-content{
  background:#fff; margin: 5% auto; width: 92%; max-width: 640px;
  border-radius: 20px; border: 1px solid var(--stroke);
  box-shadow: 0 30px 60px rgba(17,22,45,.35);
  overflow:hidden; display:flex; flex-direction:column;
  animation: slideIn .24s ease;
  max-height: 90vh;
}
@keyframes slideIn{ from{ transform: translateY(-24px); opacity:.7; } to{ transform:none; opacity:1; } }
.modal-header{
  padding: 16px 20px; border-bottom: 1px solid var(--stroke);
  background: linear-gradient(180deg, rgba(255,255,255,.75), rgba(255,255,255,.95));
  display:flex; align-items:center; justify-content:space-between;
}
.modal-body{ padding: 18px 20px; overflow:auto; }
.close-modal{ color:#9aa7ff; font-size: 28px; font-weight: 800; cursor:pointer; }
.close-modal:hover{ color: var(--primary-color); }

/* ===== Pregunta del día ===== */
.question{
  font-size: 1.15rem; font-weight:800; color: var(--ink);
  background: rgba(154,167,255,.10);
  border-left: 6px solid var(--accent-color);
  border-radius: 14px;
  padding: 14px 16px; margin-bottom: 12px;
}
.answers{ margin-top: 14px; display:flex; flex-direction:column; gap:12px; }
.answer-item{
  background: #f8f9ff; padding: 12px 14px; border-radius: 12px;
  border-left: 5px solid var(--accent-color);
  display:flex; align-items:center; gap:12px;
}

/* Blur hasta responder */
.answer-item{ position: relative; }
.answer-item .answer-text{ white-space: pre-wrap; }
.answer-item.blurred .answer-text{ filter: blur(10px); user-select:none; }
.answer-item.blurred .blur-hint{
  position:absolute; inset:0; display:flex; align-items:center; justify-content:center;
  background: rgba(255,255,255,.6); font-weight: 800; border-radius: 12px; text-align:center; padding:10px;
}

/* ===== Mapa distancia ===== */
.distance-map-container{
  margin-top: 12px; border-radius: 18px; overflow:hidden;
  border: 1px solid var(--stroke);
  box-shadow: var(--shadow-md);
  height: 420px; position:relative;
}
#distanceMap{ height:100%; width:100%; z-index:1; }
.distance-info{
  position:absolute; top: 14px; right: 14px;
  background: rgba(255,255,255,.95);
  padding: 14px; border-radius: 14px;
  border: 1px solid var(--stroke);
  box-shadow: var(--shadow-sm); z-index:2; max-width: 320px; backdrop-filter: blur(4px);
}
.distance-info h4{
  margin-bottom:6px; color: var(--primary-color);
  font-family: 'Playfair Display', serif;
}
.distance-value{
  font-size: 1.6rem; font-weight: 900; color: var(--primary-color);
  text-shadow: 0 6px 18px rgba(255,106,162,.25);
  margin: 6px 0 8px 0;
}
.location-form{ display:flex; flex-direction:column; gap:10px; margin-top: 8px; }
.location-badge{
  display:inline-flex; align-items:center; gap:8px;
  padding: 6px 10px; border-radius: 999px;
  background: var(--gradient); color:#fff; font-size:.82rem; margin-top: 6px;
  border: 1px solid rgba(255,255,255,.45);
  box-shadow: 0 8px 20px rgba(31,36,65,.10);
}
.location-badge img{ width:20px; height:20px; border-radius:50%; object-fit:cover; }

/* ===== Perfil ===== */
.profile-section{ display:flex; align-items:center; gap:14px; margin-bottom: 14px; }
.profile-picture{
  width:80px; height:80px; border-radius:50%; object-fit:cover;
  border: 3px solid transparent;
  box-shadow: 0 10px 24px rgba(31,36,65,.18);
}
.profile-form{ display:flex; flex-direction:column; gap:10px; margin-top: 10px; }
.profile-form label{
  background: #fff; color: var(--primary-color);
  padding: 10px 14px; border-radius: 12px;
  border: 1px solid var(--stroke);
  box-shadow: 0 8px 24px rgba(154,167,255,.25);
  text-align:center; transition: transform .12s ease;
}
.profile-form label:hover{ transform: translateY(-2px); }

/* ===== Popover añadir foto (viajes) ===== */
.travel-actions{ position:relative; display:flex; gap:10px; align-items:center; }
.photo-popover{
  position:absolute; top:48px; right:0; z-index:5;
  width:min(420px, calc(100% - 20px));
  background:#fff; border:1px solid var(--stroke); border-radius:14px;
  box-shadow: 0 18px 40px rgba(0,0,0,.15);
  padding:14px 14px 12px;
  transform: translateY(-8px); opacity:0; pointer-events:none;
  transition: transform .22s ease, opacity .18s ease;
}
.photo-popover.open{ transform: translateY(0); opacity:1; pointer-events:auto; }
.photo-popover::before{
  content:""; position:absolute; top:-8px; right:18px;
  width:16px; height:16px; background:#fff; border-left:1px solid var(--stroke); border-top:1px solid var(--stroke);
  transform: rotate(45deg);
}
.photo-popover-header{
  display:flex; align-items:center; justify-content:space-between; gap:8px; margin-bottom:10px;
}
.photo-popover-title{ font-weight:800; color:var(--ink); }
.photo-popover .close-btn{
  width:34px; height:34px; border-radius:10px; border:none; cursor:pointer;
  background:#f5f5f7; display:flex; align-items:center; justify-content:center;
}
.photo-popover .close-btn:hover{ background:#efeff3; }
.photo-form-inline{ display:flex; align-items:center; gap:10px; }
.photo-form-inline input[type="url"]{
  flex:1; min-width:160px; margin:0;
  border:1px solid #ddd; border-radius:10px; padding:10px 12px; font-size:.95rem; background:#fafafa;
}
.photo-form-inline input[type="url"]:focus{
  border-color: var(--accent-color);
  outline:none; box-shadow: 0 0 0 3px rgba(162,155,254,.15);
}
.photo-form-inline .button{ border-radius:10px; padding:10px 14px; font-weight:800; }
.photo-hint{ margin-top:8px; font-size:.85rem; color:#8a8fa3; }

/* Variante panel deslizante (si la usas) */
.photo-panel{
  display:block; overflow:hidden; max-height:0; opacity:0; transform: translateY(-6px);
  transition: max-height .3s ease, opacity .25s ease, transform .25s ease;
  background:#fff; border:1px solid var(--stroke); border-radius:12px;
  box-shadow: 0 8px 22px rgba(0,0,0,.06); margin-top:10px; padding:0 12px;
}
.photo-panel.open{ max-height:200px; opacity:1; transform: translateY(0); padding:12px; }

/* ===== Streak badges ===== */
.streak-badges{ display:flex; gap:12px; flex-wrap:wrap; margin: -2px 0 10px 0; }
.streak-badge{
  display:inline-flex; align-items:center; gap:8px;
  background:#fff; border:1px solid var(--stroke);
  padding:10px 14px; border-radius:14px; font-weight:800; color: var(--ink);
  box-shadow: var(--shadow-sm);
}
.streak-badge i{ font-size:1.1rem; color: var(--primary-color); }
.streak-badge.best{ border-color: var(--accent-color); background: rgba(154,167,255,.10); }

/* ===== Toasts ===== */
#toasts{
  position: fixed; right: 16px; bottom: 16px;
  display:flex; flex-direction:column; gap:10px; z-index:9999; pointer-events:none;
}
.toast{
  pointer-events:auto; min-width: 260px; max-width: 92vw; overflow:hidden;
  border-radius:14px; background:#121524; color:#fff;
  border: 1px solid var(--stroke);
  box-shadow: 0 20px 40px rgba(0,0,0,.35);
  animation: slideIn .25s ease-out;
}
.toast .toast-content{ display:flex; align-items:center; gap:10px; padding: 12px 14px; }
.toast .dot{ width:10px; height:10px; border-radius:999px; background:#9aa7ff; }
.toast.info    { border-left:6px solid #60a5fa; }
.toast.success { border-left:6px solid #34d399; }
.toast.error   { border-left:6px solid #f87171; }
.toast.success .dot{ background:#34d399; }
.toast.error   .dot{ background:#f87171; }
.toast .text{ line-height:1.3 }
.toast .close{ margin-left:auto; background:transparent; border:0; color:#fff; font-size:18px; cursor:pointer; opacity:.8; }
.toast .close:hover{ opacity:1; }
.toast .progress{ height:3px; width:100%; background: linear-gradient(90deg, #9aa7ff, #ff6aa2); transition: width linear; }
.toast.closing{ animation: fadeOut .25s ease-in forwards; }
@keyframes slideIn{ from{ transform: translateY(12px); opacity: 0; } to{ transform: translateY(0); opacity: 1; } }
@keyframes fadeOut{ to { transform: translateY(6px); opacity: 0; } }

/* ===== Buscador + Paginación ===== */
.travel-tools{
  display:flex; gap:10px; align-items:center; flex-wrap:wrap; margin-bottom: 10px;
}
.travel-tools input[type="search"]{
  flex:1; min-width:220px; background:#fff; border:1px solid var(--stroke);
  border-radius:12px; padding:10px 14px; font-size:1rem; box-shadow: inset 0 1px 0 rgba(255,255,255,.35);
}
.travel-tools .clear-btn{
  background:#fff; color: var(--primary-color);
  border:1px solid var(--stroke);
  border-radius:10px; padding:10px 12px; font-weight:800;
  box-shadow: var(--shadow-sm); transition: transform .12s ease;
}
.travel-tools .clear-btn:hover{ transform: translateY(-2px); }

.pager{
  display:flex; gap:8px; justify-content:center; align-items:center; margin-top:12px; flex-wrap:wrap;
}
.pager button{
  background:#fff; color: var(--ink);
  border: 1px solid var(--stroke);
  border-radius:10px; padding:8px 12px; font-weight:800;
  box-shadow: var(--shadow-sm); transition: transform .12s ease;
}
.pager button:hover{ transform: translateY(-2px); }
.pager button[disabled]{ opacity:.45; cursor:not-allowed; transform:none; }
.pager .page-btn.active{
  background: var(--gradient); color:#fff; border:0;
  box-shadow: 0 8px 20px rgba(232,67,147,.35);
}

/* ===== Footer ===== */
.site-footer{
  background: var(--gradient); color:#fff; text-align:center;
  padding: 20px; margin-top: 40px;
  border-top-left-radius: 20px; border-top-right-radius: 20px;
  box-shadow: 0 -20px 40px rgba(31,36,65,.12) inset;
  position: relative;
}
.site-footer::before{
  content:""; position:absolute; top:0; left:0; right:0; height:3px; background: rgba(255,255,255,.3);
}
.site-footer p{ margin:0; font-weight:700; font-size:1rem; }
.autor-link{ text-decoration:none; color:#fff; border-bottom:2px solid rgba(255,255,255,.6); padding-bottom:2px; }
.autor-link:hover{ color:#fff; border-color:#fff; }

/* ===== Icono ajustes ===== */
.settings-icon{
  position: fixed; top: 24px; left: 24px;
  width: 50px; height: 50px; border-radius:50%;
  background:#fff; color: var(--primary-color);
  display:flex; align-items:center; justify-content:center; font-size:1.5rem;
  border: 1px solid var(--stroke);
  box-shadow: var(--shadow-sm);
  z-index: 1000;
  transition: transform .15s ease, background .15s ease, color .15s ease;
}
.settings-icon:hover{ background: var(--primary-color); color:#fff; transform: translateY(-2px) rotate(15deg); }

/* ===== Animaciones de entrada genericas ===== */
@keyframes fadeInSec{ from{ opacity:0; transform: translateY(18px);} to{ opacity:1; transform:none;} }
.animate-in{ animation: fadeInSec .6s ease forwards; }
.delay-1{ animation-delay: .15s; }
.delay-2{ animation-delay: .30s; }
.delay-3{ animation-delay: .45s; }
.delay-4{ animation-delay: .60s; }

/* ===== Responsive ===== */
@media (max-width: 992px){
  .travels-grid, .wishlist-grid{ grid-template-columns: repeat(auto-fill, minmax(260px,1fr)); }
  .distance-info{ max-width: 260px; }
  .travel-cover{ height: 180px; }
}
@media (max-width: 768px){
  .section{ border-radius: 18px; padding: 20px; }
  .banner{ height: 360px; }
  .logout{ top: 18px; right: 18px; }
  .travel-tabs .travel-tab, .wishlist-tabs .wishlist-tab{ padding: 8px 10px; }
  .distance-map-container{ height: 360px; }
  .distance-info{ position:relative; inset:auto; margin: 10px; }
  .profile-section{ flex-direction:column; text-align:center; }
}
@media (max-width: 576px){
  .travels-grid, .wishlist-grid{ grid-template-columns: 1fr; }
  .banner{ height: 320px; }
  .travel-cover{ height: 160px; }
  .user-avatar{ width:40px; height:40px; }
  .banner-overlay h1::after{ width: 96px; }
}


    </style>
</head>

<body>
  {% set flash_messages = get_flashed_messages(with_categories=true) %}

  <!-- Zona toasts -->
  <div id="toasts" aria-live="polite" aria-atomic="true"></div>

  <!-- Corazones flotantes -->
  <div class="floating-hearts" id="hearts-container"></div>

  <!-- MODAL EDITAR WISHLIST -->
  <div id="editWishlistModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>Editar producto</h2>
        <span class="close-modal">&times;</span>
      </div>
      <div class="modal-body">
        <form method="POST" action="/edit_wishlist_item" id="editWishlistForm">
          <input type="hidden" name="item_id" id="editItemId">
          <input type="text" name="product_name" id="editProductName" placeholder="Nombre del producto" required>
          <input type="url" name="product_link" id="editProductLink" placeholder="Enlace (opcional)">
          <select name="priority" id="editPriority" required>
            <option value="alta">Prioridad: Alta 🔴</option>
            <option value="media">Prioridad: Media 🟡</option>
            <option value="baja">Prioridad: Baja 🟢</option>
          </select>
          <textarea name="notes" id="editNotes" placeholder="Notas (opcional)" rows="3"></textarea>

          <div style="display:flex; align-items:center; gap:10px; margin: 6px 0 16px 0;">
            <input type="checkbox" id="editIsGift" name="is_gift" style="width:auto;">
            <label for="editIsGift" style="margin:0;">¿Es un regalo? 🎁</label>
          </div>

          <button type="submit"><i class="fas fa-save"></i> Guardar cambios</button>
        </form>
      </div>
    </div>
  </div>

  <div class="container">
    {% if not session.username %}
      <!-- LOGIN -->
      <div class="login-container">
        <div class="login-box animate-in">
          <h3>Iniciar sesión</h3>
          <form method="POST">
            <input type="text" name="username" placeholder="Usuario" required>
            <input type="password" name="password" placeholder="Contraseña" required>
            <button type="submit">Entrar <i class="fas fa-arrow-right"></i></button>
          </form>
        </div>
      </div>

    {% else %}

      <a href="/logout" class="logout"><i class="fas fa-sign-out-alt"></i> Cerrar sesión</a>

      <!-- BANNER -->
      <div class="section banner animate-in">
        {% if banner_file %}
          <img src="{{ banner_file }}" alt="Banner">
        {% else %}
          <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1200 450'%3E%3Crect width='1200' height='450' fill='%23ffe8f3'/%3E%3C/svg%3E" alt="Banner por defecto">
        {% endif %}
        <div class="banner-overlay">
          <div class="scroll-hint" aria-hidden="true"></div>

          <h1>Christian <span class="heart">❤️</span> Clara</h1>
          <form method="POST" enctype="multipart/form-data" class="banner-form">
            <label for="banner-upload" class="custom-file-upload">
              <i class="fas fa-image"></i> Elegir imagen
            </label>
            <input id="banner-upload" type="file" name="banner" accept="image/*" required style="display: none;">
            <button type="submit"><i class="fas fa-sync-alt"></i> Cambiar banner</button>
          </form>
        </div>
      </div>

      <!-- PERFIL (icono) -->
      <div class="settings-icon" id="settingsIcon">
        <i class="fas fa-user-cog"></i>
      </div>

      <!-- MODAL PERFIL -->
      <div id="profileModal" class="modal">
        <div class="modal-content">
          <div class="modal-header">
            <h2>Mi Perfil</h2>
            <span class="close-modal">&times;</span>
          </div>
          <div class="modal-body">
            <div class="profile-section">
              {% if profile_pictures.get(session.username) %}
                <img src="{{ profile_pictures.get(session.username) }}" alt="Foto de perfil" class="profile-picture">
              {% else %}
                <div class="profile-picture" style="background: var(--gradient); display: flex; align-items: center; justify-content: center; color: white; font-size: 2rem; font-weight: bold;">
                  {{ session.username[0]|upper }}
                </div>
              {% endif %}
              <div>
                <h4>Hola, {{ session.username }}</h4>
                <p>Actualiza tu foto o cambia tu contraseña.</p>
              </div>
            </div>

            <!-- FORM: Cambiar foto -->
            <form method="POST" enctype="multipart/form-data" class="profile-form" style="margin-bottom: 20px;">
              <label for="profile-upload" class="custom-file-upload">
                <i class="fas fa-user-circle"></i> Elegir foto de perfil
              </label>
              <input id="profile-upload" type="file" name="profile_picture" accept="image/*" style="display: none;">
              <button type="submit" name="update_profile"><i class="fas fa-sync-alt"></i> Actualizar foto</button>
            </form>

            <hr style="border:none;border-top:1px solid #eee;margin: 10px 0 20px 0;">

            <!-- FORM: Cambiar contraseña -->
            <form method="POST" class="profile-form">
              <input type="hidden" name="change_password" value="1">
              <input type="password" name="current_password" placeholder="Contraseña actual" required>
              <input type="password" name="new_password" placeholder="Nueva contraseña" required>
              <input type="password" name="confirm_password" placeholder="Repite la nueva contraseña" required>
              <button type="submit">
                <i class="fas fa-lock"></i> Cambiar contraseña
              </button>
            </form>
          </div>
        </div>
      </div>

      <!-- Contadores -->
      <div class="section animate-in delay-1">
        <h3>Nosotros</h3>
        <div class="counters">
          <div class="counter-item">
            <h4>Días juntos</h4>
            <p>{{ days_together }}</p>
          </div>
          {% if days_until_meeting is not none %}
          <div class="counter-item">
            <h4>Días hasta vernos</h4>
            <p>{{ days_until_meeting }}</p>
          </div>
          {% endif %}
        </div>
        <form method="POST" class="inline-form">
          <input type="date" name="meeting_date" required>
          <button type="submit"><i class="fas fa-calendar-alt"></i> Actualizar fecha</button>
        </form>
      </div>

      <!-- Mapa de Distancia -->
      <div class="section animate-in delay-2">
        <h3>Distancia</h3>
        <p>Cuánta distancia hay entre nosotros.</p>

        <div class="distance-map-container">
          <div id="distanceMap"></div>
          <div class="distance-info">
            <h4>Distancia entre nosotros</h4>
            <div class="distance-value" id="distanceValue">Cargando...</div>
            <div id="locationInfo">
              <div class="location-badge">
                {% if profile_pictures.get('mochito') %}
                  <img src="{{ profile_pictures.get('mochito') }}" alt="Christian">
                {% else %}
                  <span>C</span>
                {% endif %}
                <span id="christianLocation">Algemesí, Valencia</span>
              </div>
              <div class="location-badge">
                {% if profile_pictures.get('mochita') %}
                  <img src="{{ profile_pictures.get('mochita') }}" alt="Clara">
                {% else %}
                  <span>C</span>
                {% endif %}
                <span id="claraLocation">Córdoba</span>
              </div>
            </div>

            <!-- 🌍 FORM: Actualizar ubicación (manual o automática) -->
            <form class="location-form" id="locationForm">
              <div class="row">
                <input type="text" id="userLocation" placeholder="Tu ciudad/barrio (opcional si usas el botón)">
                <button type="button" id="useMyLocationBtn">
                  <i class="fas fa-location-arrow"></i> Usar mi ubicación
                </button>
              </div>
              <button type="submit"><i class="fas fa-map-marker-alt"></i> Actualizar con texto</button>
              <small style="opacity:.8; display:block; margin-top:6px;">Consejo: en HTTPS el navegador te permite usar la ubicación real.</small>
            </form>
          </div>
        </div>
      </div>

      <!-- Horarios -->
      <div class="section animate-in delay-2">
        <h3>Nuestros Horarios</h3>
        <p>Nuestros horarios y activiades (editables).</p>
        <a href="/horario">
          <button style="width: 100%;">
            <i class="fas fa-calendar-alt"></i> Ver Horarios
          </button>
        </a>
      </div>

      <!-- Pregunta diaria -->
      <div class="section animate-in delay-2">
        <h3>Pregunta del día</h3>
        <p class="question"><b>{{ question }}</b></p>

        <div class="streak-badges">
          <div class="streak-badge">
            <i class="fas fa-fire"></i>
            Racha actual: {{ current_streak }} día{% if current_streak != 1 %}s{% endif %}
          </div>
          <div class="streak-badge best">
            <i class="fas fa-trophy"></i>
            Mejor racha: {{ best_streak }} día{% if best_streak != 1 %}s{% endif %}
          </div>
        </div>

        {% if show_answers %}
          <div class="answers">
            {% for u, a in answers %}
              <div class="answer-item">
                <div class="user-avatar">
                  {% if profile_pictures.get(u) %}
                    <img src="{{ profile_pictures.get(u) }}" alt="{{ u }}">
                  {% else %}
                    {{ u[0]|upper }}
                  {% endif %}
                </div>
                <div><b>{{ u }}:</b> <span class="answer-text">{{ a }}</span></div>
              </div>
            {% endfor %}
          </div>
        {% else %}
          {% if user_answer and not other_answer %}
            <div class="answers">
              <div class="answer-item">
                <div class="user-avatar">
                  {% if profile_pictures.get(username) %}
                    <img src="{{ profile_pictures.get(username) }}" alt="{{ username }}">
                  {% else %}
                    {{ username[0]|upper }}
                  {% endif %}
                </div>
                <div><b>Tú:</b> <span class="answer-text">{{ user_answer }}</span></div>
              </div>
            </div>
            <p style="margin-top:10px;">Aún falta la respuesta de <b>{{ other_user }}</b> 🕒</p>

          {% elif (not user_answer) and other_answer %}
            <form method="POST" class="inline-form" style="margin-bottom:15px;">
              <input type="text" name="answer" placeholder="Tu respuesta..." required>
              <button type="submit"><i class="fas fa-paper-plane"></i> Enviar</button>
            </form>

            <div class="answers">
              <div class="answer-item blurred">
                <div class="user-avatar">
                  {% if profile_pictures.get(other_user) %}
                    <img src="{{ profile_pictures.get(other_user) }}" alt="{{ other_user }}">
                  {% else %}
                    {{ other_user[0]|upper }}
                  {% endif %}
                </div>
                <div>
                  <b>{{ other_user }}:</b>
                  <span class="answer-text">{{ other_answer }}</span>
                  <div class="blur-hint">Responde para desbloquear</div>
                </div>
              </div>
            </div>

          {% else %}
            <form method="POST" class="inline-form">
              <input type="text" name="answer" placeholder="Tu respuesta..." required>
              <button type="submit"><i class="fas fa-paper-plane"></i> Enviar</button>
            </form>
          {% endif %}
        {% endif %}
      </div>

      <!-- Lista de deseos -->
      <div class="section animate-in delay-3">
        <h3>Nuestra Lista de Deseos</h3>
        <p>Cosas que nos gustaría tener o regalarnos mutuamente.</p>

        <div class="wishlist-tabs" id="wishlist-tabs-container">
          <div class="wishlist-tab active" data-tab="wanted">Deseados</div>
          <div class="wishlist-tab" data-tab="purchased">Comprados</div>
          <div class="wishlist-tab" data-tab="add-wishlist">Añadir Deseo</div>
        </div>

        <!-- Deseados -->
        <div class="wishlist-content active" id="wanted-tab">
          <div class="wishlist-grid">
            {% for id, product_name, product_link, notes, created_by, created_at, is_purchased, priority, is_gift in wishlist_items if not is_purchased %}
              {% set pri = (priority or 'media') %}
              {% set soy_creador = (created_by == username) %}
              {% set oculto_para_mi = (is_gift and not soy_creador) %}

              <div class="wishlist-card {% if oculto_para_mi %}locked{% endif %}">
                <div class="wishlist-status status-wanted">Deseado</div>

                <div style="display:flex; gap:8px; flex-wrap:wrap;">
                  <div class="priority-chip {{ 'priority-high' if pri=='alta' else 'priority-low' if pri=='baja' else 'priority-mid' }}">
                    <i class="fas fa-flag"></i> {{ pri|capitalize }}
                  </div>
                  {% if is_gift %}
                    <div class="gift-chip"><i class="fas fa-gift"></i> Regalo</div>
                  {% endif %}
                </div>

                {% if oculto_para_mi %}
                  <div class="gift-mask">
                    🎁 <div>¡Esto es un regalo para ti!</div>
                    <small>Los detalles están ocultos para mantener la sorpresa.</small>
                  </div>
                {% else %}
                  <h3 class="wishlist-product">{{ product_name }}</h3>
                  {% if product_link %}
                    <a href="{{ product_link }}" target="_blank" class="wishlist-link">
                      <i class="fas fa-link"></i> Ver producto
                    </a>
                  {% endif %}
                  {% if notes %}
                    <p class="wishlist-notes">{{ notes }}</p>
                  {% endif %}
                {% endif %}

                <div class="wishlist-meta">
                  <span>
                    <div class="user-avatar" style="width: 20px; height: 20px; display: inline-block; vertical-align: middle; margin-right: 5px;">
                      {% if profile_pictures.get(created_by) %}
                        <img src="{{ profile_pictures.get(created_by) }}" alt="{{ created_by }}">
                      {% else %}
                        {{ created_by[0]|upper }}
                      {% endif %}
                    </div>
                    Creado por {{ created_by }}
                  </span>
                  <span>{{ created_at[:10] }}</span>
                </div>

                {% if not oculto_para_mi %}
                <div class="wishlist-actions">
                  <form method="POST" action="/toggle_wishlist_status">
                    <input type="hidden" name="item_id" value="{{ id }}">
                    <button type="submit" class="icon-btn" title="Marcar como comprado">
                      <i class="fas fa-check"></i>
                    </button>
                  </form>

                  <button class="icon-btn" title="Editar"
                          onclick='openEditModal({{ id }}, {{ product_name|tojson }}, {{ product_link|tojson }}, {{ (notes or "")|tojson }}, {{ pri|tojson }}, {{ is_gift|tojson }})'>
                    <i class="fas fa-edit"></i>
                  </button>

                  {% if created_by == username %}
                  <form method="POST" action="/delete_wishlist_item" onsubmit="return confirm('¿Estás seguro de que quieres eliminar este producto?');">
                    <input type="hidden" name="item_id" value="{{ id }}">
                    <button type="submit" class="icon-btn" title="Eliminar">
                      <i class="fas fa-trash"></i>
                    </button>
                  </form>
                  {% endif %}
                </div>
                {% endif %}
              </div>
            {% else %}
              <p>No hay productos en tu lista de deseos. ¡Añade el primero!</p>
            {% endfor %}
          </div>
        </div>

        <!-- Comprados -->
        <div class="wishlist-content" id="purchased-tab">
          <div class="wishlist-grid">
            {% for id, product_name, product_link, notes, created_by, created_at, is_purchased, priority, is_gift in wishlist_items if is_purchased %}
              {% set pri = (priority or 'media') %}
              {% set soy_creador = (created_by == username) %}
              {% set oculto_para_mi = (is_gift and not soy_creador) %}

              <div class="wishlist-card purchased {% if oculto_para_mi %}locked{% endif %}">
                <div class="wishlist-status status-purchased">Comprado</div>

                <div style="display:flex; gap:8px; flex-wrap:wrap;">
                  <div class="priority-chip {{ 'priority-high' if pri=='alta' else 'priority-low' if pri=='baja' else 'priority-mid' }}">
                    <i class="fas fa-flag"></i> {{ pri|capitalize }}
                  </div>
                  {% if is_gift %}
                    <div class="gift-chip"><i class="fas fa-gift"></i> Regalo</div>
                  {% endif %}
                </div>

                {% if oculto_para_mi %}
                  <div class="gift-mask">
                    🎁 <div>¡Esto es (o era) un regalo para ti!</div>
                    <small>Detalles ocultos para mantener la sorpresa.</small>
                  </div>
                {% else %}
                  <h3 class="wishlist-product">{{ product_name }}</h3>
                  {% if product_link %}
                    <a href="{{ product_link }}" target="_blank" class="wishlist-link">
                      <i class="fas fa-link"></i> Ver producto
                    </a>
                  {% endif %}
                  {% if notes %}
                    <p class="wishlist-notes">{{ notes }}</p>
                  {% endif %}
                {% endif %}

                <div class="wishlist-meta">
                  <span>
                    <div class="user-avatar" style="width: 20px; height: 20px; display: inline-block; vertical-align: middle; margin-right: 5px;">
                      {% if profile_pictures.get(created_by) %}
                        <img src="{{ profile_pictures.get(created_by) }}" alt="{{ created_by }}">
                      {% else %}
                        {{ created_by[0]|upper }}
                      {% endif %}
                    </div>
                    Creado por {{ created_by }}
                  </span>
                  <span>{{ created_at[:10] }}</span>
                </div>

                {% if not oculto_para_mi %}
                <div class="wishlist-actions">
                  <form method="POST" action="/toggle_wishlist_status">
                    <input type="hidden" name="item_id" value="{{ id }}">
                    <button type="submit" class="icon-btn" title="Marcar como no comprado">
                      <i class="fas fa-undo"></i>
                    </button>
                  </form>

                  <button class="icon-btn" title="Editar"
                          onclick='openEditModal({{ id }}, {{ product_name|tojson }}, {{ product_link|tojson }}, {{ (notes or "")|tojson }}, {{ pri|tojson }}, {{ is_gift|tojson }})'>
                    <i class="fas fa-edit"></i>
                  </button>

                  {% if created_by == username %}
                  <form method="POST" action="/delete_wishlist_item" onsubmit="return confirm('¿Estás seguro de que quieres eliminar este producto?');">
                    <input type="hidden" name="item_id" value="{{ id }}">
                    <button type="submit" class="icon-btn" title="Eliminar">
                      <i class="fas a fa-trash"></i>
                    </button>
                  </form>
                  {% endif %}
                </div>
                {% endif %}
              </div>
            {% else %}
              <p>No hay productos comprados todavía.</p>
            {% endfor %}
          </div>
        </div>

        <!-- Añadir deseo -->
        <div class="wishlist-content" id="add-wishlist-tab">
          <div class="wishlist-form">
            <h4>Añadir nuevo producto</h4>
            <form method="POST">
              <input type="text" name="product_name" placeholder="Nombre del producto" required>
              <input type="url" name="product_link" placeholder="Enlace (opcional)">
              <textarea name="wishlist_notes" placeholder="Notas (opcional)" rows="3"></textarea>

              <select name="priority" required style="margin-bottom:15px;">
                <option value="alta">Prioridad: Alta 🔴</option>
                <option value="media" selected>Prioridad: Media 🟡</option>
                <option value="baja">Prioridad: Baja 🟢</option>
              </select>

              <div style="display:flex; align-items:center; gap:10px; margin: 6px 0 16px 0;">
                <input type="checkbox" id="is_gift" name="is_gift" style="width:auto;">
                <label for="is_gift" style="margin:0;">¿Es un regalo (ocultar a la otra persona)? 🎁</label>
              </div>

              <button type="submit"><i class="fas fa-plus"></i> Añadir a la lista</button>
            </form>
          </div>
        </div>
      </div>

      <!-- Viajes -->
      <div class="section animate-in delay-4">
        <h3>Nuestros Viajes</h3>
        <p>Lugares que hemos visitado y destinos que soñamos conocer juntos.</p>

        <div class="travel-tabs" id="travel-tabs-container">
          <div class="travel-tab active" data-tab="visited">Lugares Visitados</div>
          <div class="travel-tab" data-tab="wishlist-travel">Quiero Ir</div>
          <div class="travel-tab" data-tab="add-travel">Añadir Viaje</div>
        </div>

        <!-- Visitados -->
        <div class="travel-content active" id="visited-tab">
          <div class="travel-tools">
            <input type="search" id="visited-search" placeholder="Buscar destino/país en visitados...">
            <button type="button" class="clear-btn" onclick="clearTravelSearch('visited')">Limpiar</button>
          </div>

          <div class="travels-grid">
            {% for id, destination, description, travel_date, is_visited, created_by in travels if is_visited %}
              <div class="travel-card visited">
                <div class="travel-cover">
                  {% if travel_photos_dict[id] %}
                    <div class="travel-photos">
                      {% for photo in travel_photos_dict[id] %}
                        <img src="{{ photo.url }}" alt="{{ destination }}" style="max-width:100%; border-radius:10px; margin:5px 0;">
                      {% endfor %}
                    </div>
                  {% else %}
                    <div class="empty-album">
                      <i class="fas fa-map-marker-alt"></i>
                    </div>
                  {% endif %}
                  <div class="travel-status status-visited">Visitado</div>
                </div>

                <div class="travel-info">
                  <h3 class="travel-destination">{{ destination }}</h3>
                  {% if travel_date %}<p class="travel-date">{{ travel_date }}</p>{% endif %}
                  {% if description %}<p class="travel-description">{{ description }}</p>{% endif %}

                  <div class="travel-meta">
                    <span>{{ travel_photos_dict[id]|length }} fotos</span>
                    <span>
                      <div class="user-avatar" style="width: 20px; height: 20px; display: inline-block; vertical-align: middle; margin-right: 5px;">
                        {% if profile_pictures.get(created_by) %}<img src="{{ profile_pictures.get(created_by) }}" alt="{{ created_by }}">{% else %}{{ created_by[0]|upper }}{% endif %}
                      </div>
                      Creado por {{ created_by }}
                    </span>
                  </div>

                  <div class="travel-actions">
                    <form method="POST" action="/toggle_travel_status">
                      <input type="hidden" name="travel_id" value="{{ id }}">
                      <button type="submit" class="icon-btn" title="Mover a deseados">
                        <i class="fas fa-heart"></i>
                      </button>
                    </form>

                    <button type="button" class="icon-btn plus" title="Añadir foto" onclick="togglePhotoMenu('visited-{{ id }}')">
                      <i class="fas fa-plus"></i>
                    </button>

                    <div class="photo-popover" id="photo-popover-visited-{{ id }}">
                      <div class="photo-popover-header">
                        <div class="photo-popover-title">Añadir foto por enlace</div>
                        <button type="button" class="close-btn" onclick="togglePhotoMenu('visited-{{ id }}')">
                          <i class="fas fa-times"></i>
                        </button>
                      </div>
                      <form method="POST" class="photo-form-inline" onsubmit="closePhotoMenuAfterSubmit('visited-{{ id }}')">
                        <input type="hidden" name="travel_id" value="{{ id }}">
                        <input type="url" name="travel_photo_url" placeholder="Pega enlace (https://...)" required>
                        <button type="submit" class="button"><i class="fas fa-check"></i> Guardar</button>
                      </form>
                      <div class="photo-hint">Valen JPG/PNG/GIF o URLs públicas (Imgur, Google Photos compartido, etc.).</div>
                    </div>

                    <form method="POST" action="/delete_travel" onsubmit="return confirm('¿Estás seguro de que quieres eliminar este viaje?');">
                      <input type="hidden" name="travel_id" value="{{ id }}">
                      <button type="submit" class="icon-btn" title="Eliminar viaje">
                        <i class="fas fa-trash"></i>
                      </button>
                    </form>
                  </div>
                </div>
              </div>
            {% else %}
              <p>No hay lugares visitados todavía. ¡Añade el primero!</p>
            {% endfor %}
          </div>
          <div class="pager" id="visited-pager"></div>
        </div>

        <!-- Quiero ir -->
        <div class="travel-content" id="wishlist-travel-tab">
          <div class="travel-tools">
            <input type="search" id="wishlist-search" placeholder="Buscar destino/país en quiero ir...">
            <button type="button" class="clear-btn" onclick="clearTravelSearch('wishlist')">Limpiar</button>
          </div>

          <div class="travels-grid">
            {% for id, destination, description, travel_date, is_visited, created_by in travels if not is_visited %}
              <div class="travel-card wishlist">
                <div class="travel-cover">
                  {% if travel_photos_dict[id] %}
                    <div class="travel-photos">
                      {% for photo in travel_photos_dict[id] %}
                        <img src="{{ photo.url }}" alt="{{ destination }}" style="max-width:100%; border-radius:10px; margin:5px 0;">
                      {% endfor %}
                    </div>
                  {% else %}
                    <div class="empty-album">
                      <i class="fas fa-map-marker-alt"></i>
                    </div>
                  {% endif %}
                  <div class="travel-status status-wishlist">Deseado</div>
                </div>

                <div class="travel-info">
                  <h3 class="travel-destination">{{ destination }}</h3>
                  {% if description %}<p class="travel-description">{{ description }}</p>{% endif %}

                  <div class="travel-meta">
                    <span>{{ travel_photos_dict[id]|length }} fotos</span>
                    <span>
                      <div class="user-avatar" style="width: 20px; height: 20px; display: inline-block; vertical-align: middle; margin-right: 5px;">
                        {% if profile_pictures.get(created_by) %}<img src="{{ profile_pictures.get(created_by) }}" alt="{{ created_by }}">{% else %}{{ created_by[0]|upper }}{% endif %}
                      </div>
                      Creado por {{ created_by }}
                    </span>
                  </div>

                  <div class="travel-actions">
                    <form method="POST" action="/toggle_travel_status">
                      <input type="hidden" name="travel_id" value="{{ id }}">
                      <button type="submit" class="icon-btn" title="Marcar como visitado">
                        <i class="fas fa-check"></i>
                      </button>
                    </form>

                    <button type="button" class="icon-btn plus" title="Añadir foto" onclick="togglePhotoMenu('wish-{{ id }}')">
                      <i class="fas fa-plus"></i>
                    </button>

                    <div class="photo-popover" id="photo-popover-wish-{{ id }}">
                      <div class="photo-popover-header">
                        <div class="photo-popover-title">Añadir foto por enlace</div>
                        <button type="button" class="close-btn" onclick="togglePhotoMenu('wish-{{ id }}')">
                          <i class="fas fa-times"></i>
                        </button>
                      </div>
                      <form method="POST" class="photo-form-inline" onsubmit="closePhotoMenuAfterSubmit('wish-{{ id }}')">
                        <input type="hidden" name="travel_id" value="{{ id }}">
                        <input type="url" name="travel_photo_url" placeholder="Pega enlace (https://...)" required>
                        <button type="submit" class="button"><i class="fas fa-check"></i> Guardar</button>
                      </form>
                      <div class="photo-hint">Valen JPG/PNG/GIF o URLs públicas (Imgur, Google Photos compartido, etc.).</div>
                    </div>

                    <form method="POST" action="/delete_travel" onsubmit="return confirm('¿Estás seguro de que quieres eliminar este viaje?');">
                      <input type="hidden" name="travel_id" value="{{ id }}">
                      <button type="submit" class="icon-btn" title="Eliminar viaje">
                        <i class="fas fa-trash"></i>
                      </button>
                    </form>
                  </div>
                </div>
              </div>
            {% else %}
              <p>No hay destinos en tu lista de deseos. ¡Añade el primero!</p>
            {% endfor %}
          </div>
          <div class="pager" id="wishlist-pager"></div>
        </div>

        <!-- Añadir viaje -->
        <div class="travel-content" id="add-travel-tab">
          <div class="travel-form">
            <h4>Añadir nuevo viaje</h4>
            <form method="POST">
              <input type="text" name="travel_destination" placeholder="Destino" required>
              <textarea name="travel_description" placeholder="Descripción (opcional)" rows="3"></textarea>
              <input type="date" name="travel_date">
              <div style="display: flex; align-items: center; margin-bottom: 15px;">
                <input type="checkbox" id="travel_visited" name="travel_visited" style="width: auto; margin-right: 10px;">
                <label for="travel_visited">¿Ya lo hemos visitado?</label>
              </div>
              <button type="submit"><i class="fas fa-plus"></i> Añadir viaje</button>
            </form>
          </div>
        </div>

      {% endif %}
  </div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
// =====================
// TOASTS (Flash + helper)
// =====================
(function () {
  const msgs = {{ (flash_messages if flash_messages is defined else get_flashed_messages(with_categories=true)) | tojson | safe }};
  const wrap = document.getElementById('toasts');
  if (!wrap) return;

  function closeToast(el){
    el.classList.add('closing');
    el.addEventListener('animationend', ()=> el.remove(), { once:true });
  }

  window.showToast = function(category, text){
    const el = document.createElement('div');
    el.className = 'toast ' + (category || 'info');
    el.innerHTML = `
      <div class="toast-content">
        <span class="dot"></span>
        <span class="text">${text}</span>
        <button class="close" aria-label="Cerrar">&times;</button>
      </div>
      <div class="progress"></div>
    `;
    el.querySelector('.close').addEventListener('click', () => closeToast(el));
    const life = 3500;
    setTimeout(() => closeToast(el), life);
    requestAnimationFrame(() => { el.querySelector('.progress').style.width = '0%'; });
    wrap.appendChild(el);
  };

  if (Array.isArray(msgs)) {
    msgs.forEach(([cat, txt], i) => {
      setTimeout(()=> window.showToast(cat, txt), i * 150);
    });
  }
})();


// =====================
// Corazones de fondo
// =====================
function createHearts() {
  const container = document.getElementById('hearts-container');
  if (!container) return;
  const heartCount = 15;
  for (let i = 0; i < heartCount; i++) {
    const heart = document.createElement('div');
    heart.classList.add('heart');
    heart.innerHTML = '❤';
    heart.style.left = Math.random() * 100 + 'vw';
    heart.style.animationDelay = Math.random() * 5 + 's';
    heart.style.fontSize = (Math.random() * 15 + 15) + 'px';
    container.appendChild(heart);
  }
}


// =====================
// Tabs: Wishlist & Viajes
// =====================
function setupTabs() {
  // Wishlist
  document.querySelectorAll('#wishlist-tabs-container .wishlist-tab').forEach(tab => {
    tab.addEventListener('click', () => {
      document.querySelectorAll('#wishlist-tabs-container .wishlist-tab').forEach(t => t.classList.remove('active'));
      document.querySelectorAll('.wishlist-content').forEach(c => c.classList.remove('active'));
      tab.classList.add('active');
      const tabId = tab.getAttribute('data-tab');
      const target = document.getElementById(`${tabId}-tab`);
      if (target) target.classList.add('active');
    });
  });

  // Travel
  document.querySelectorAll('#travel-tabs-container .travel-tab').forEach(tab => {
    tab.addEventListener('click', () => {
      document.querySelectorAll('#travel-tabs-container .travel-tab').forEach(t => t.classList.remove('active'));
      document.querySelectorAll('.travel-content').forEach(c => c.classList.remove('active'));
      tab.classList.add('active');
      const tabId = tab.getAttribute('data-tab');
      const target = document.getElementById(`${tabId}-tab`);
      if (target) target.classList.add('active');
    });
  });
}


// =====================
// Modal genérico
// =====================
(function setupModals(){
  document.addEventListener('click', (e) => {
    if (e.target.matches('.close-modal')) {
      document.querySelectorAll('.modal').forEach(m => m.style.display = 'none');
    }
  });
  window.addEventListener('click', (event) => {
    document.querySelectorAll('.modal').forEach(modal => {
      if (event.target === modal) modal.style.display = 'none';
    });
  });
  const settingsIcon = document.getElementById('settingsIcon');
  const profileModal = document.getElementById('profileModal');
  if (settingsIcon && profileModal) {
    settingsIcon.addEventListener('click', () => { profileModal.style.display = 'block'; });
  }
})();

// Editor wishlist
window.openEditModal = function(id, name, link, notes, priority, is_gift) {
  const modal = document.getElementById('editWishlistModal');
  if (!modal) return;
  const $ = (sel) => document.getElementById(sel);

  $('editItemId').value = id;
  $('editProductName').value = name || '';
  $('editProductLink').value = link || '';
  $('editNotes').value = notes || '';
  $('editPriority').value = priority || 'media';
  $('editIsGift').checked = !!is_gift;

  modal.style.display = 'block';
};


// =====================
// Popover fotos (viajes)
// =====================
function togglePhotoMenu(key){
  const id = 'photo-popover-' + key;
  const target = document.getElementById(id);
  if(!target) return;
  document.querySelectorAll('.photo-popover.open').forEach(p => { if(p.id !== id) p.classList.remove('open'); });
  target.classList.toggle('open');
  if(target.classList.contains('open')){
    const input = target.querySelector('input[type="url"]');
    if(input){ setTimeout(()=> input.focus(), 120); }
  }
}
window.togglePhotoMenu = togglePhotoMenu;

function closePhotoMenuAfterSubmit(key){
  const id = 'photo-popover-' + key;
  const target = document.getElementById(id);
  if(target) setTimeout(()=> target.classList.remove('open'), 50);
}
window.closePhotoMenuAfterSubmit = closePhotoMenuAfterSubmit;

document.addEventListener('click', (e) => {
  const openPop = document.querySelector('.photo-popover.open');
  if(!openPop) return;
  const isInsidePopover = openPop.contains(e.target);
  const isPlusBtn = e.target.closest('.icon-btn.plus');
  if(!isInsidePopover && !isPlusBtn){ openPop.classList.remove('open'); }
});
document.addEventListener('keydown', (e) => { if(e.key === 'Escape'){ document.querySelectorAll('.photo-popover.open').forEach(p => p.classList.remove('open')); } });


// =====================
// MAPA (Leaflet) + Distancia + Geocoding + GEOLOCALIZACIÓN REAL
// =====================
let map, christianMarker, claraMarker, distanceLine;
let christianLocation = { lat: 39.1925, lng: -0.4353, name: "Algemesí, Valencia" };
let claraLocation     = { lat: 37.8882, lng: -4.7794, name: "Córdoba" };

function initMap() {
  const mapEl = document.getElementById('distanceMap');
  if (!mapEl || typeof L === 'undefined') return;

  map = L.map('distanceMap').setView([39.5, -3.0], 6);

  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a>'
  }).addTo(map);

  const christianAvatar = {{ (profile_pictures.get('mochito') or 
    'data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><circle cx="50" cy="50" r="50" fill="%23e84393"/><text x="50" y="60" font-size="40" text-anchor="middle" fill="white">C</text></svg>') | tojson }};
  const claraAvatar = {{ (profile_pictures.get('mochita') or 
    'data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><circle cx="50" cy="50" r="50" fill="%23a29bfe"/><text x="50" y="60" font-size="40" text-anchor="middle" fill="white">C</text></svg>') | tojson }};

  const christianIcon = L.divIcon({
    className: 'custom-div-icon',
    html: `<div style="background-image:url(${christianAvatar});background-size:cover;width:40px;height:40px;border-radius:50%;border:3px solid white;box-shadow:0 0 10px rgba(0,0,0,.5);"></div>`,
    iconSize: [40, 40], iconAnchor: [20, 20]
  });
  const claraIcon = L.divIcon({
    className: 'custom-div-icon',
    html: `<div style="background-image:url(${claraAvatar});background-size:cover;width:40px;height:40px;border-radius:50%;border:3px solid white;box-shadow:0 0 10px rgba(0,0,0,.5);"></div>`,
    iconSize: [40, 40], iconAnchor: [20, 20]
  });

  christianMarker = L.marker([christianLocation.lat, christianLocation.lng], { icon: christianIcon }).addTo(map);
  claraMarker     = L.marker([claraLocation.lat, claraLocation.lng], { icon: claraIcon }).addTo(map);

  updateDistanceLine();
  updateDistanceInfo();
  loadSavedLocations();
}

function updateDistanceLine() {
  if (!map || !christianMarker || !claraMarker) return;
  if (distanceLine) map.removeLayer(distanceLine);

  distanceLine = L.polyline(
    [[christianLocation.lat, christianLocation.lng], [claraLocation.lat, claraLocation.lng]],
    { color: '#e84393', weight: 3, dashArray: '10, 10', lineJoin: 'round' }
  ).addTo(map);

  const group = new L.featureGroup([christianMarker, claraMarker]);
  map.fitBounds(group.getBounds().pad(0.2));
}

function updateDistanceInfo() {
  const el = document.getElementById('distanceValue');
  if (!el) return;
  const distance = calculateDistance(
    christianLocation.lat, christianLocation.lng,
    claraLocation.lat, claraLocation.lng
  );
  el.textContent = `${distance.toFixed(1)} km`;

  const ch = document.getElementById('christianLocation');
  const cl = document.getElementById('claraLocation');
  if (ch) ch.textContent = christianLocation.name;
  if (cl) cl.textContent = claraLocation.name;
}

function calculateDistance(lat1, lon1, lat2, lon2) {
  const R = 6371;
  const dLat = deg2rad(lat2 - lat1);
  const dLon = deg2rad(lon2 - lon1);
  const a = Math.sin(dLat/2) * Math.sin(dLat/2) +
            Math.cos(deg2rad(lat1)) * Math.cos(deg2rad(lat2)) *
            Math.sin(dLon/2) * Math.sin(dLon/2);
  const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
  return R * c;
}
function deg2rad(deg){ return deg * (Math.PI/180); }

// Geocodificación directa (texto -> coords)
async function geocodeAddress(address) {
  try {
    const url = `https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(address)}&limit=1`;
    const response = await fetch(url, { headers: { 'Accept-Language': 'es' } });
    const data = await response.json();
    if (Array.isArray(data) && data.length > 0) {
      return {
        lat: parseFloat(data[0].lat),
        lng: parseFloat(data[0].lon),
        name: (data[0].display_name || '').split(',')[0] || address
      };
    }
    throw new Error('Ubicación no encontrada');
  } catch (error) {
    console.error('Error en geocodificación:', error);
    window.showToast?.('error', 'No se pudo encontrar la ubicación. Intenta con una dirección más específica.');
    return null;
  }
}

// 🔁 Geocodificación inversa (coords -> nombre corto)
async function reverseGeocode(lat, lon) {
  try {
    const res = await fetch(`https://nominatim.openstreetmap.org/reverse?format=jsonv2&lat=${lat}&lon=${lon}`, { headers: { 'Accept-Language': 'es' }});
    const data = await res.json();
    const city = data.address?.city || data.address?.town || data.address?.village || data.address?.hamlet || data.name || 'Mi ubicación';
    const country = data.address?.country_code ? data.address.country_code.toUpperCase() : '';
    return `${city}${country ? ', ' + country : ''}`;
  } catch {
    return 'Mi ubicación';
  }
}

// Persistencia local
function saveLocations() {
  try {
    const locations = { christian: christianLocation, clara: claraLocation };
    localStorage.setItem('coupleLocations', JSON.stringify(locations));
  } catch { /* nada */ }
}
function loadSavedLocations() {
  try {
    const saved = localStorage.getItem('coupleLocations');
    if (!saved) return;
    const locations = JSON.parse(saved);
    christianLocation = locations.christian || christianLocation;
    claraLocation     = locations.clara     || claraLocation;
    christianMarker?.setLatLng([christianLocation.lat, christianLocation.lng]);
    claraMarker?.setLatLng([claraLocation.lat, claraLocation.lng]);
    updateDistanceLine();
    updateDistanceInfo();
  } catch { /* nada */ }
}

// Formulario: actualizar por texto
function setupLocationForm() {
  const form = document.getElementById('locationForm');
  if (!form) return;
  form.addEventListener('submit', async function(e) {
    e.preventDefault();
    const input = document.getElementById('userLocation');
    if (!input || !input.value.trim()) return;

    const btn = form.querySelector('button[type="submit"]');
    const original = btn ? btn.innerHTML : '';
    if (btn) { btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Buscando...'; btn.disabled = true; }

    const locationData = await geocodeAddress(input.value.trim());

    if (locationData) {
      const currentUser = {{ (session.username or '') | tojson }};
      if (currentUser === 'mochito') {
        christianLocation = locationData;
        christianMarker?.setLatLng([locationData.lat, locationData.lng]);
      } else if (currentUser === 'mochita') {
        claraLocation = locationData;
        claraMarker?.setLatLng([locationData.lat, locationData.lng]);
      } else {
        christianLocation = locationData;
        christianMarker?.setLatLng([locationData.lat, locationData.lng]);
      }
      updateDistanceLine();
      updateDistanceInfo();
      saveLocations();
      input.value = '';
      window.showToast?.('success', `¡Ubicación actualizada! Ahora estás en ${locationData.name}`);
    }

    if (btn) { btn.innerHTML = original; btn.disabled = false; }
  });
}

// 🌐 Botón: usar ubicación real del navegador
function setupUseMyLocation() {
  const btn = document.getElementById('useMyLocationBtn');
  if (!btn) return;

  btn.addEventListener('click', () => {
    if (!('geolocation' in navigator)) {
      window.showToast?.('error', 'Tu navegador no soporta geolocalización.');
      return;
    }

    const original = btn.innerHTML;
    btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Obteniendo...';
    btn.disabled = true;

    const opts = { enableHighAccuracy: true, timeout: 12000, maximumAge: 0 };
    navigator.geolocation.getCurrentPosition(async (pos) => {
      const { latitude: lat, longitude: lng } = pos.coords;
      const name = await reverseGeocode(lat, lng);

      const currentUser = {{ (session.username or '') | tojson }};
      if (currentUser === 'mochito') {
        christianLocation = { lat, lng, name };
        christianMarker?.setLatLng([lat, lng]);
      } else if (currentUser === 'mochita') {
        claraLocation = { lat, lng, name };
        claraMarker?.setLatLng([lat, lng]);
      } else {
        christianLocation = { lat, lng, name };
        christianMarker?.setLatLng([lat, lng]);
      }

      updateDistanceLine();
      updateDistanceInfo();
      saveLocations();
      window.showToast?.('success', `Ubicación actualizada: ${name}`);
      btn.innerHTML = original; btn.disabled = false;
    }, (err) => {
      const msg = {
        1: 'Has denegado el permiso de ubicación.',
        2: 'No se pudo determinar tu ubicación.',
        3: 'Tiempo de espera agotado.'
      }[err.code] || 'Error al obtener la ubicación.';
      window.showToast?.('error', msg + ' Puedes introducir la ciudad manualmente.');
      btn.innerHTML = original; btn.disabled = false;
    }, opts);
  });
}


// =====================
// Paginación + Buscador (viajes) – 6 por página
// =====================
function paginateGrid(gridEl, pagerEl, pageSize = 6) {
  if (!gridEl || !pagerEl) return { goToFirst(){}, refresh(){} };
  const allCards = Array.from(gridEl.querySelectorAll(':scope > .travel-card'));
  let emptyMsg = gridEl.querySelector('.no-results');
  if (!emptyMsg) {
    emptyMsg = document.createElement('p');
    emptyMsg.className = 'no-results';
    emptyMsg.textContent = 'Sin resultados.';
    emptyMsg.style.display = 'none';
    emptyMsg.style.gridColumn = '1/-1';
    gridEl.appendChild(emptyMsg);
  }
  let current = 1;
  function getMatched() { return allCards.filter(el => el.dataset.match !== '0'); }
  function hideAll() { allCards.forEach(el => { el.style.display = 'none'; }); }
  function makeBtn(label, onClick, opts = {}) {
    const b = document.createElement('button');
    b.textContent = label;
    b.className = 'page-btn' + (opts.active ? ' active' : '');
    if (opts.title) b.title = opts.title;
    if (opts.disabled) b.disabled = true;
    if (!opts.disabled && onClick) b.addEventListener('click', onClick);
    return b;
  }
  function renderPager(totalPages) {
    pagerEl.innerHTML = '';
    pagerEl.appendChild(makeBtn('«', () => { current = 1; renderPage(); }, { disabled: current === 1, title: 'Primera' }));
    pagerEl.appendChild(makeBtn('‹', () => { current = Math.max(1, current - 1); renderPage(); }, { disabled: current === 1, title: 'Anterior' }));
    const windowSize = 5;
    let from = Math.max(1, current - Math.floor(windowSize / 2));
    let to = Math.min(totalPages, from + windowSize - 1);
    from = Math.max(1, to - windowSize + 1);
    for (let p = from; p <= to; p++) {
      pagerEl.appendChild(makeBtn(String(p), () => { current = p; renderPage(); }, { active: p === current }));
    }
    pagerEl.appendChild(makeBtn('›', () => { current = Math.min(totalPages, current + 1); renderPage(); }, { disabled: current === totalPages, title: 'Siguiente' }));
    pagerEl.appendChild(makeBtn('»', () => { current = totalPages; renderPage(); }, { disabled: current === totalPages, title: 'Última' }));
  }
  function renderPage() {
    const matched = getMatched();
    const total = matched.length;
    const totalPages = Math.max(1, Math.ceil(total / pageSize));
    if (current > totalPages) current = totalPages;
    if (total === 0) {
      hideAll(); emptyMsg.style.display = ''; pagerEl.style.display = 'none'; pagerEl.innerHTML = ''; return;
    } else { emptyMsg.style.display = 'none'; }
    if (totalPages <= 1) {
      pagerEl.style.display = 'none'; pagerEl.innerHTML = '';
      hideAll(); matched.forEach(el => { el.style.display = ''; });
      return;
    }
    pagerEl.style.display = 'flex';
    const start = (current - 1) * pageSize;
    const end = start + pageSize;
    hideAll();
    matched.forEach((el, i) => { el.style.display = (i >= start && i < end) ? '' : 'none'; });
    renderPager(totalPages);
  }
  renderPage();
  return { goToFirst: () => { current = 1; renderPage(); }, refresh: () => renderPage() };
}
let visitedPagerAPI = null;
let wishlistPagerAPI = null;

function setupTravelPagination() {
  const visitedGrid = document.querySelector('#visited-tab .travels-grid');
  const visitedPager = document.getElementById('visited-pager');
  const wishlistGrid = document.querySelector('#wishlist-travel-tab .travels-grid');
  const wishlistPager = document.getElementById('wishlist-pager');
  visitedPagerAPI = paginateGrid(visitedGrid, visitedPager, 6);
  wishlistPagerAPI = paginateGrid(wishlistGrid, wishlistPager, 6);
}

function setupTravelSearch(scopeId, inputId, pagerAPI) {
  const grid = document.querySelector(`#${scopeId} .travels-grid`);
  const input = document.getElementById(inputId);
  if (!grid || !input) return;

  const cards = Array.from(grid.querySelectorAll(':scope > .travel-card'));
  function applyFilter(termRaw) {
    const term = (termRaw || '').trim().toLowerCase();
    cards.forEach(card => {
      const dest = (card.querySelector('.travel-destination')?.textContent || '').toLowerCase();
      const desc = (card.querySelector('.travel-description')?.textContent || '').toLowerCase();
      const date = (card.querySelector('.travel-date')?.textContent || '').toLowerCase();
      const match = term === '' || dest.includes(term) || desc.includes(term) || date.includes(term);
      card.dataset.match = match ? '1' : '0';
    });
    pagerAPI?.goToFirst?.();
    pagerAPI?.refresh?.();
  }
  input.addEventListener('input', () => applyFilter(input.value));
  applyFilter(input.value);
}
function clearTravelSearch(which) {
  if (which === 'visited') {
    const i = document.getElementById('visited-search');
    if (i) { i.value = ''; setupTravelSearch('visited-tab', 'visited-search', visitedPagerAPI); }
  }
  if (which === 'wishlist') {
    const i = document.getElementById('wishlist-search');
    if (i) { i.value = ''; setupTravelSearch('wishlist-travel-tab', 'wishlist-search', wishlistPagerAPI); }
  }
}


// =====================
// DOMContentLoaded
// =====================
document.addEventListener('DOMContentLoaded', function() {
  createHearts();
  setupTabs();
  initMap();
  setupLocationForm();
  setupUseMyLocation(); // <-- activa el botón de ubicación real
  setupTravelPagination();
  setupTravelSearch('visited-tab', 'visited-search', visitedPagerAPI);
  setupTravelSearch('wishlist-travel-tab', 'wishlist-search', wishlistPagerAPI);

  document.querySelectorAll('.section, .banner').forEach((el, index) => {
    el.classList.add('animate-in');
    el.classList.add(`delay-${index % 5}`);
  });

  document.querySelectorAll('input[type="file"]').forEach(input => {
    input.addEventListener('change', function() {
      const label = this.previousElementSibling;
      if (label && this.files.length > 0) {
        const icon = label.querySelector('i');
        if (icon) icon.className = 'fas fa-check';
      }
    });
  });
});
</script>

<footer class="site-footer">
    <p>Esta web ha sido realizada por 
        <a href="https://www.instagram.com/chriismartinezz/" target="_blank" class="autor-link">Christian Martínez</a> ❤️
    </p>
</footer>

</body>
</html>

