<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Panel admin ‚Äî Mochitos</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;800&display=swap" rel="stylesheet">
<style>
:root{
  --brand:#e84393; --bg:#faf7fb; --card:#ffffff; --ink:#1f2937; --muted:#6b7280; --ok:#10b981; --warn:#f59e0b; --err:#ef4444; --line:#efefef;
}
*{box-sizing:border-box}
html,body{margin:0;padding:0;background:var(--bg);color:var(--ink);font-family:Montserrat,system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif}
.container{max-width:980px;margin:26px auto;padding:0 14px}
h1{font-size:1.6rem;margin:0 0 10px}
.subtitle{color:var(--muted);margin:0 0 18px}
.nav{display:flex;gap:8px;flex-wrap:wrap;margin:8px 0 16px}
a.btn,button.btn{display:inline-block;text-decoration:none;border:1px solid var(--line);background:#fff;color:var(--ink);padding:10px 14px;border-radius:10px;cursor:pointer}
.btn.brand{background:var(--brand);color:#fff;border-color:var(--brand)}
.btn.ghost{background:#fff}
.grid{display:grid;gap:16px}
@media(min-width:900px){ .grid{grid-template-columns:1fr 1fr} }
.card{background:var(--card);border:1px solid var(--line);border-radius:16px;padding:16px;box-shadow:0 6px 14px rgba(0,0,0,.04)}
.card h2{margin:0 0 10px;font-size:1.2rem}
.row{display:grid;gap:10px}
label{font-weight:600;font-size:.92rem}
input[type=text], input[type=password], input[type=url], input[type=datetime-local], select, textarea{
  width:100%;padding:10px 12px;border:1px solid #e5e7eb;border-radius:10px;background:#fff;font:inherit
}
textarea{min-height:90px;resize:vertical}
.actions{display:flex;gap:10px;flex-wrap:wrap;margin-top:8px}
.badge{display:inline-block;padding:4px 10px;border-radius:999px;background:#f3f4f6;color:#111;font-size:.78rem;margin-right:8px}
.badge.ok{background:#ecfdf5;color:#065f46}
.badge.warn{background:#fffbeb;color:#92400e}
.badge.err{background:#fef2f2;color:#991b1b}
table{width:100%;border-collapse:collapse}
th,td{padding:10px;border-bottom:1px solid #eee;text-align:left;font-size:.95rem}
th{color:#555}
.small{color:var(--muted);font-size:.9rem}
hr.sep{border:0;height:1px;background:#eee;margin:14px 0}
.tag{font-size:.82rem;background:#f2f2f2;border-radius:999px;padding:2px 8px;display:inline-block}
</style>
</head>
<body>
<div class="container">
  <h1>Panel de administraci√≥n</h1>
  <p class="subtitle">Hola <b>{{ username }}</b>. Solo t√∫ (mochito) puedes ver esto. <a class="btn" href="/">‚Üê Volver</a></p>

  <!-- NUEVO BOT√ìN -->
   <div class="nav">
  <a href="/admin/questions" class="btn brand">üìù Gestionar preguntas</a>
  <a href="/admin/achievements" class="btn">üèÖ Premios y medallas</a>
</div>

  <!-- FIN NUEVO BOT√ìN -->

  <div class="grid">
    <!-- Usuarios -->
    <div class="card">
      <h2>Usuarios</h2>
      <form method="post" action="/admin/reset_pw" class="row" autocomplete="off">
        <div>
          <label for="user">Usuario</label>
          <select id="user" name="user" required>
            <option value="mochito">mochito</option>
            <option value="mochita">mochita</option>
          </select>
        </div>
        <div>
          <label for="new_password">Nueva contrase√±a</label>
          <input id="new_password" name="new_password" type="password" minlength="4" required placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
        </div>
        <div class="actions">
          <button class="btn brand" type="submit">Cambiar contrase√±a</button>
          <a class="btn" href="/push/debug" target="_blank">Gu√≠a activar push</a>
        </div>
        <p class="small">Se actualiza al momento (hash seguro). No pide la contrase√±a actual.</p>
      </form>
    </div>

    <!-- Notificaciones (enviar ahora) -->
    <div class="card">
      <h2>Notificaciones ‚Äî Enviar ahora</h2>
      <form method="post" action="/admin/push/send_now" class="row">
        <div>
          <label for="target_now">Destino</label>
          <select id="target_now" name="target" required>
            <option value="mochita">mochita</option>
            <option value="mochito">mochito</option>
            <option value="both" selected>Ambos</option>
          </select>
        </div>
        <div>
          <label for="title_now">T√≠tulo</label>
          <input id="title_now" name="title" type="text" required placeholder="Ej: Te quiero üòò">
        </div>
        <div>
          <label for="body_now">Mensaje</label>
          <textarea id="body_now" name="body" placeholder="Texto opcional"></textarea>
        </div>
        <div class="grid">
          <div>
            <label for="url_now">URL (opcional)</label>
            <input id="url_now" name="url" type="url" placeholder="/#pregunta">
          </div>
          <div>
            <label for="tag_now">Tag (opcional)</label>
            <input id="tag_now" name="tag" type="text" placeholder="mi-tag">
          </div>
        </div>
        <div class="grid">
          <div>
            <label for="icon_now">Icon (opcional)</label>
            <input id="icon_now" name="icon" type="url" placeholder="/static/icon.png">
          </div>
          <div>
            <label for="badge_now">Badge (opcional)</label>
            <input id="badge_now" name="badge" type="url" placeholder="/static/badge.png">
          </div>
        </div>
        <div class="actions">
          <button class="btn brand" type="submit">Enviar ahora</button>
        </div>
        <p class="small">Usa tus claves VAPID actuales. Suscripciones ya las gestionas en la app.</p>
      </form>
    </div>

    <!-- Notificaciones (programar) -->
    <div class="card">
      <h2>Notificaciones ‚Äî Programar</h2>
      <form method="post" action="/admin/push/schedule" class="row">
        <div>
          <label for="target_sched">Destino</label>
          <select id="target_sched" name="target" required>
            <option value="mochita">mochita</option>
            <option value="mochito">mochito</option>
            <option value="both" selected>Ambos</option>
          </select>
        </div>
        <div>
          <label for="title_sched">T√≠tulo</label>
          <input id="title_sched" name="title" type="text" required placeholder="Ej: Cuenta atr√°s ‚ù§Ô∏è">
        </div>
        <div>
          <label for="body_sched">Mensaje</label>
          <textarea id="body_sched" name="body" placeholder="Texto opcional"></textarea>
        </div>
        <div>
          <label for="when_local">Fecha y hora (Europe/Madrid)</label>
          <input id="when_local" name="when_local" type="datetime-local" required>
        </div>
        <div class="grid">
          <div>
            <label for="url_sched">URL</label>
            <input id="url_sched" name="url" type="url" placeholder="/#contador">
          </div>
          <div>
            <label for="tag_sched">Tag</label>
            <input id="tag_sched" name="tag" type="text" placeholder="countdown">
          </div>
        </div>
        <div class="grid">
          <div>
            <label for="icon_sched">Icon</label>
            <input id="icon_sched" name="icon" type="url" placeholder="/static/icon.png">
          </div>
          <div>
            <label for="badge_sched">Badge</label>
            <input id="badge_sched" name="badge" type="url" placeholder="/static/badge.png">
          </div>
        </div>
        <div class="actions">
          <button class="btn brand" type="submit">Programar</button>
        </div>
        <p class="small">Se guarda como hora local de Madrid. El scheduler del backend las env√≠a al llegar la hora.</p>
      </form>
    </div>

    <!-- Lista de programadas -->
    <div class="card">
      <h2>Programadas</h2>
      {% if pending and pending|length > 0 %}
      <table>
        <thead>
          <tr><th>ID</th><th>Destino</th><th>T√≠tulo</th><th>Cuando</th><th></th></tr>
        </thead>
        <tbody>
        {% for r in pending %}
          <tr>
            <td>#{{ r.id }}</td>
            <td><span class="tag">{{ r.target }}</span></td>
            <td>{{ r.title }}</td>
            <td class="small">{{ r.when_at }}</td>
            <td>
              <form method="post" action="/admin/push/cancel" style="display:inline">
                <input type="hidden" name="id" value="{{ r.id }}">
                <button class="btn" type="submit">Cancelar</button>
              </form>
            </td>
          </tr>
        {% endfor %}
        </tbody>
      </table>
      {% else %}
        <p class="small">No hay notificaciones pendientes.</p>
      {% endif %}

      <hr class="sep">
      <h3 style="margin:0 0 8px;font-size:1.05rem">√öltimas enviadas</h3>
      {% if recent and recent|length > 0 %}
      <table>
        <thead><tr><th>ID</th><th>Destino</th><th>T√≠tulo</th><th>Enviada</th></tr></thead>
        <tbody>
        {% for r in recent %}
          <tr>
            <td>#{{ r.id }}</td>
            <td><span class="tag">{{ r.target }}</span></td>
            <td>{{ r.title }}</td>
            <td class="small">{{ r.sent_at }}</td>
          </tr>
        {% endfor %}
        </tbody>
      </table>
      {% else %}
        <p class="small">A√∫n no hay hist√≥rico.</p>
      {% endif %}
    </div>
  </div>
</div>
</body>
</html>
